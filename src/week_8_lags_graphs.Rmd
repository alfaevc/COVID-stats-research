1. import libraries and and dataset
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(readr)
data <- read_csv("covid.com.csv") %>% 
  select(c(-1))
```

2. preprocess data
```{r}
# choose which state
state = "WASHINGTON"
state_data <- data %>% 
  filter(STATE==state) %>% 
  select(c(3, 9, 14, 15))

# group event categories into easing/lifting and imposing
group_event_catg <- function(x){
  new_col = c()
  check = substr(x, nchar(x), nchar(x))
  if(check %in% c("M", "R")){
    new_col <- append(new_col, "Mandatory/Recommended")
  } else if (check %in% c("E", "L")){
    new_col <- append(new_col, "Ease/Lifting")
  } else {
    new_col <- append(new_col, x)
  }
}
state_data$big_event_catg <- sapply(state_data$EVENT_CATG_S,
                                    FUN=group_event_catg)
```


3. plot lag graphs
```{r, message=FALSE, warning=FALSE}
# 1 day lag
ggplot(data=state_data)+
  geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500),
                 col=as.factor(big_event_catg)))+
  labs(title=paste(str_to_title(state),"lag 1"), 
       x="Today's Norm New Confirmed Cases",
       y="Tomorrow's Norm NC Cases",
       col = "Event_Category")+
  theme_bw()

# 3 day lag
ggplot(data=state_data)+
  geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500, n=3),
                 col=as.factor(big_event_catg)))+
  labs(title=paste(str_to_title(state),"lag 3"), 
       x="Today's Norm New Confirmed Cases",
       y="Norm NC Cases 3 days later",
       col = "Event_Category")+
  theme_bw()

# 5 day lag
ggplot(data=state_data)+
  geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500, n=5),
                 col=as.factor(big_event_catg)))+
  labs(title=paste(str_to_title(state),"lag 5"), 
       x="Today's Norm New Confirmed Cases",
       y="Norm NC Cases 5 days later",
       col = "Event_Category")+
  theme_bw()

# 7 day lag
ggplot(data=state_data)+
  geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500, n=7),
                 col=as.factor(big_event_catg)))+
  labs(title=paste(str_to_title(state),"lag 7"), 
       x="Today's Norm New Confirmed Cases",
       y="Norm NC Cases 7 days later",
       col = "Event_Category")+
  theme_bw()

# 10 day lag
ggplot(data=state_data)+
  geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500, n=10),
                 col=as.factor(big_event_catg)))+
  labs(title=paste(str_to_title(state),"lag 10"), 
       x="Today's Norm New Confirmed Cases",
       y="Norm NC Cases 10 days later",
       col = "Event_Category")+
  theme_bw()
  
```


4. put into function
```{r}
plot_lag <- function(state, lead_n){
  state_data <- data[data$STATE==state,]
  state_data$big_event_catg <- sapply(state_data$EVENT_CATG_S,
                                    FUN=group_event_catg)
  
  plot <- ggplot(data=state_data)+
    geom_point(aes(x=NEWCD_NORM_500, y=lead(NEWCD_NORM_500, n=lead_n),
                   col=as.factor(big_event_catg)))+
    labs(title=paste(str_to_title(state),"lag", lead_n), 
         x="Today's Norm New Confirmed Cases",
         y=paste("Norm NC Cases", lead_n, "days ago"),
         col = "Event_Category")+
    theme_bw()
  
  print(plot)
}
```


5. run plot functions in specified state and lag days
```{r, message=FALSE, warning=FALSE}
state = "WASHINGTON"
for (day in c(1, 3, 5, 7, 10)){
  plot_lag(state, day)
}
```


