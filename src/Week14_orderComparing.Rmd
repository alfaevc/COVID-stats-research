---
title: "Week14_orderComparing"
author: "Melody Ma"
date: "12/2/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r, message=FALSE, warning=FALSE, echo = FALSE}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(readr)
library(ggfortify)
library(ggseas)
```

## States Mask Order

```{r, message=FALSE, warning=FALSE, echo = FALSE}
data <- read_csv("covid.com.csv") %>% 
  select(c(-1)) %>%  select(c(3, 9, 14,2)) 

# 15M stands for Mandatory Mask/Facecover Order
# See README of COVID_ALL_G1.xlsx
head(data[!is.na(data$EVENT_CATG_S) & data$EVENT_CATG_S == "15M",])
```

```{r}

states = c("WASHINGTON","MASSACHUSETTS","NEW YORK", "TEXAS")

event_order = "15M"
states_df = rep(NA,4)
states_mask = rep(NA,4)
for (i in (1: length(states))){
  #state_abb[i] = state.abb[which(state.name == states[i])]
  # if a state never issues mask order then plot all data
# else the plot starts at the day of mask order
  state1_data = data[data$STATE==states[i],]
  state1_mask = which(!is.na(state1_data$EVENT_CATG_S) & state1_data$EVENT_CATG_S == event_order)
  
  if(!identical(state1_mask, integer(0))){
  state1_data = state1_data[state1_mask:nrow(state1_data),]
  } else{
   states[i] = paste(states[i], "(NO MASK ORDER)")
  }
  print(state1_data)
  print(state1_mask)
  
  state1_data$DAYS = state1_data$DATE
  state1_data$DAYS = as.numeric(state1_data$DATE-state1_data$DATE[1]-10)
  
  states_df[i] = state1_data
  states_mask[i] = state1_mask
}

state1_color = "#FC4E07"
state2_color = "#00AFBB"
state3_color = "#303F4B"
state4_color = "#90FDBB"





  
```

```{r}
states_trend <- ggplot() +
  geom_line(data = states_df[1], aes(x = DAYS, y = NEWCD_NORM_500), color = state1_color, size = 1.25) +
  geom_text(aes(x = tail(states_df[1]$DAYS, 1)+3, y = tail(states_df[1]$NEWCD_NORM_500, 1), label = state1_abb), color = state1_color) +
  geom_line(data = state2_data, aes(x = DAYS, y = NEWCD_NORM_500), color = state2_color, size = 1.25) +
  geom_text(aes(x = tail(state2_data$DAYS, 1)+3, y = tail(state2_data$NEWCD_NORM_500, 1), label = state2_abb), color = state2_color) +
  xlab("Number of Days Since Mask Order") + ylab("Normalized Daily New Cases") + ggtitle(paste("Mask Order in", state1, "and", state2))
  
states_trend
```

```{r}
states = c("WASHINGTON","MASSACHUSETTS","NEW YORK", "TEXAS")

event_order = "15M"
master_df = data.frame(DATE=as.Date(character()),
               NEWCD_NORM_500 = numeric(),
               EVENT_CATG_S=character(),
                STATE=character(),
               DAYS = numeric())

for (i in (1: length(states))){
  # if a state never issues mask order then plot all data
# else the plot starts at the day of mask order
  state1_data = data[data$STATE==states[i],]
  #print(state1_data)
  #state1_mask = data[data$EVENT_CATG_S==event_order,]
  state1_mask = which(!is.na(state1_data$EVENT_CATG_S) & state1_data$EVENT_CATG_S == event_order)
  #print(state1_mask)
  if(!identical(state1_mask, integer(0))){
  state1_data = state1_data[(state1_mask-14):nrow(state1_data),]
  } else{
   states[i] = paste(states[i], "(NO MASK ORDER)")
  }
  #print(state1_data)

  state1_data$DAYS = state1_data$DATE
  state1_data$DAYS = as.numeric(state1_data$DATE-state1_data$DATE[1]-14)
  master_df =rbind(master_df,state1_data)
  #states_df[i] = state1_data
  #states_mask[i] = state1_mask
  #print(master_df)
  
}


states_trend <- ggplot(data = master_df, aes(x = DAYS, y = NEWCD_NORM_500)) +
  #geom_line(data = master_df, aes(x = DAYS, y = NEWCD_NORM_500, color = STATE), size = 1, alpha = 0.7) +
  stat_rollapplyr(width = 7, align = "right", size = 1,
                    aes(col=STATE), alpha=0.7)+
  xlab("Number of Days Since Mask Order") + ylab("Normalized Daily New Cases") 
states_trend
```

