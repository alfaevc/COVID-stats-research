---
title: "Undergrad research"
authors: "Alvin Pan"
Andrew IDs: "qpan"
output:
  pdf_document:
    toc: no
  html_document:
    toc: true
    toc_float: true
    theme: spacelab
---
```{r}
library("readxl")
library(tidyverse)
```



```{r}
covid = data.frame(read_excel("covid1.xlsx"))
```



```{r}
head(covid, 10)
```

```{r}
cont.cols = c(5:11,14:17)
```



```{r}
par(mfrow=c(3,4), mar=c(4,4,2,0.5)) # Setup grid, margins
for (j in cont.cols) {
  hist(covid[,j], xlab=colnames(covid)[j],
       main=paste("Hist of", colnames(covid)[j]),
       col="lightblue", breaks=20)
}
```


```{r}
grouped.df = covid %>% group_by(STATE) %>% summarize(POPULATION = sum(sqrt(POPULATION), na.rm = TRUE), NEWCONFIRMED = sum(log(NEWCONFIRMED+1), na.rm = TRUE), CUMCONFIRMED = sum(log(CUMCONFIRMED+1), na.rm = TRUE), NEWDEATHS=sum(log(NEWDEATHS+1), na.rm = TRUE), CUMDEATHS=sum(log(CUMDEATHS+1), na.rm = TRUE)) %>% data.frame()
```

```{r}
grouped.df
```


```{r}
par(mfrow=c(2,3), mar=c(4,4,2,0.5)) # Setup grid, margins
for (j in (2:6)) {
  hist(grouped.df[,j], xlab=colnames(grouped.df)[j],
       main=paste("Hist of", colnames(grouped.df)[j]),
       col="lightblue", breaks=20)
}
```


```{r}
# generate top n states with the most people
top_pop_states <- function(data, n=5) {
  d = data %>% group_by(STATE) %>% summarize(POPULATION = mean(POPULATION, na.rm = TRUE))
  
  return (top_n(d, n=n, wt=POPULATION)[[1]])                             
}
```


```{r}
# plot covid cases for top population states
plot_states <- function(data, feature, n=5, x=2, y=3) {
  top_states = top_pop_states(covid, n)
  par(mfrow=c(x,y), mar=c(4,4,2,0.5)) # Setup grid, margins
  for (state in top_states) {
    d = data %>% filter(STATE == state) %>% select(POPULATION, DATE, NEWCONFIRMED, CUMCONFIRMED, NEWDEATHS, CUMDEATHS)
    plot(d$DATE, d[,feature], xlab = "Time", ylab = feature, main = paste("COVID cases in", state), pch = 20)
  }
}
```




```{r}
plot_states(covid, 'NEWDEATHS')
```



```{r}
plot_states(covid, 'NEWCONFIRMED')
```
